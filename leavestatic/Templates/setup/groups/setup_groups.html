{% extends 'setup.html' %}
{% load custom_filters %}
{% block title %}
    Groups - GCPS Leave System
{% endblock %}

{% block setup %}
<style>
    .groups {
        background: #fff;
        display: flex;
        flex-direction: column;
        padding: 2rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        margin-top: 2rem;
        animation: fadeIn 0.4s ease;
        button{
            box-shadow: none;
        }

    /* Header */
    .group_buttons {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1.2rem;
        border-bottom: 1px solid #ddd;
        padding-bottom: 0.5rem;
    }

    .group_buttons h2 {
        margin: 0;
        font-size: 1.6rem;
        color: #333;
        flex-grow: 1;
    }

    .group_buttons div,
    .group_buttons button {
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .group_buttons label {
        font-weight: 500;
        color: #444;
        font-size: 0.95rem;
    }

    .group_buttons input[type="checkbox"] {
        cursor: pointer;
    }

    .group_buttons button {
        padding: 0.5rem 1rem;
        border: none;
        background-color: #0077cc;
        color: white;
        border-radius: 0.3rem;
        font-size: 0.9rem;
        cursor: pointer;
        transition: background-color 0.25s ease;
    }

    .group_buttons button:hover {
        background-color: #005fa3;
    }

    /* Group Interaction Bar */
    .mid {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #f3f3f3;
        padding: 0.6rem 1rem;
        border: 1px solid #ddd;
        border-radius: 0.4rem;
        margin-bottom: 1rem;
        font-size: 0.95rem;
        animation: fadeIn 0.3s ease;
        .lvtsve,
        .lvtdsd {
        padding: 0.45rem 0.9rem;
        border: none;
        border-radius: 0.25rem;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .lvtsve {
        background-color: #28a745;
        color: #fff;
    }

    .lvtsve:hover {
        background-color: #218838;
    }

    .lvtdsd {
        background-color: #e3342f;
        color: #fff;
    }

    .lvtdsd:hover {
        background-color: #c02022;
    }

    }


    /* Active & Inactive Groups */
    .a_groups {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
    }

    /* Group Card */
    .group_item {
        display: flex;
        flex-direction: column;
        position: relative;
        background-color: #fafafa;
        border: 1px solid #ddd;
        border-radius: 0.5rem;
        width: 260px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        overflow: hidden;
        padding: 0;
        animation: cardFadeUp 0.4s ease forwards;
        opacity: 0;
        transform: translateY(10px);
        height: 200px;
    }

    .group_item input[type="checkbox"] {
        position: absolute;
        left: 10px;
        top: 10px;
        z-index: 2;
    }
    .group_item .top{
        height: 170px;
    }
    .group_item .dept-info {
        display: block;
        width: 100%;
        text-align: left;
        border: none;
        background: transparent;
        padding: 1.1rem 1rem 0.5rem;
        cursor: pointer;
        height: 100%;
    }

    .group_item h3.heading_pos {
        margin: 0;
        font-size: 1.1rem;
        color: #333;
    }

    .group_item .count {
        margin: 0.4rem 0 0;
        font-size: 0.9rem;
        color: #666;
    }

    /* Edit / Restore Buttons */
    .group_item .bot{
        height: 15%;
    }
    .group_item a .np {
        width: 100%;
        padding: 0.6rem;
        border: none;
        background-color: #0077cc;
        color: #fff;
        font-size: 0.9rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
        border-top: 1px solid #ccc;
        height: 100%;
    }

    .group_item .np:hover {
        background-color: #005fa3;
    }

    /* Inactive Section */
    .inactive_groups {
        margin-top: 2rem;
        border-top: 1px solid #ccc;
        padding-top: 1rem;
    }

    .in_header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        font-weight: 600;
        color: #444;
    }

    .rotb {
        background-color: #efefef;
        border: none;
        font-size: 1.2rem;
        padding: 0.4rem 0.6rem;
        border-radius: 50%;
        transition: transform 0.3s ease;
    }

    .in_body {
        display: none;
        margin-top: 1rem;
    }
  
}
</style>
<div class="groups" style="display: flex;">
    <div class="group_buttons">
        <h2>Groups</h2>
       
        <div>
            <a href="{% url 'staff_add' slug %}"><button type="button">New Staff</button></a>
            <a href="{% url 'group_add' slug %}"><button type="button" style="margin-right: 5px;">New Group</button></a>
        </div>
        
    </div>
    <form action="{% url 'submit_inputs' slug %}" method="post" id="group_form" class="groups_form">
        {% csrf_token %}
        <div class="mid" style="display: none;">
             <div>
                <input type="checkbox" class="multi" id="multi" onclick="
                    selAllBoxes(this.checked, 'group_item_ch')">
                <label id="select_all_label" for="multi">Select All</label>
            </div>
            <div>
                <label for="mid_sel">Action: </label>
                <div style="display: flex; flex-direction: row;">
                    <select name="form_meta" id="mid_sel" 
                    required onchange="toggleGroupSelect(this.value, 'new_group_id')">   
                        <option value="" disabled selected>Select an option</option>
                        <option value="del_group" title="Delete all staff from the selected groups">Delete</option>
                        <option value="rem_staff" title="Remove all staff from the selected groups. Affected staff will not be assigned to any group">Unassign</option>
                        <option value="change_group_group" title="Move all the staff members from the selected group(s) to a different group">Move to Group</option>
                    </select>
                    <select name="new_group_id" id="new_group_id" class="mid_sel" disabled style="display: none; margin-left: 5px;">
                        <option value="" disabled selected>Select Group</option>
                        {% for group in all_groups %}
                        <option value="{{group.id}}">{{group.name}}</option>
                        {% endfor %}
                    </select>
                </div>
                
            </div>
            <span><span class="count_selected">0</span> of <span class="count_total">{{ all_groups|length }}</span> selected</span>
            <div>
                <button type="submit" class="lvtsve">&check; Save</button>
                <button type="button" class="lvtdsd" 
                onclick="
                    resetForm('group_form'),
                    resetCounter('count_selected'),
                    hideMid('mid'),
                    resetAndHideGroupSelect('new_group_id')
                "
                >&times; Discard</button>
            </div>
        </div>
        <div class="a_groups">
            {% for group in active_groups %}
            <div class="group_item">
                <input type="checkbox"
                name="group_ids"
                value="{{group.id}}" 
                class="group_item_ch" 
                onchange="
                    selectCheckBox(this.className, 'multi'),
                    displayMid('mid'),
                    updateCounter('count_selected', this.className)"
                " 
                style="position:absolute; left:10px; top:10px;">
                <a class="top" href="{% url 'group_detail' group.id slug %}"><button type="button" class="dept-info">
                    <h3 class="heading_pos">{{ group.name }}</h3>
                    <p class="count">
                        {% with staff_list=groups_list|get_item:group %}
                            {{ staff_list|length }} staff
                        {% endwith %}
                    </p>
                </button></a>
                <a class="bot" href="{% url 'group_edit' group.id slug %}"><button type="button" class="np">Edit</button></a>
            </div>
            {% empty %}
            <div class="no-groups">No groups found.</div>
            {% endfor %}
        </div>
    </form>

    <div class="inactive_groups">
        <div class="in_header">
            <button class="rotb" type="button" style="transform: rotate(-90deg); border-radius: 50%;"
            onclick="show1('in_body'), rotateMe('.rotb')"
            >&#10094;</button>
            <p onclick="show1('in_body'), rotateMe('.rotb')">Inactive Groups (deleted)</p>
        </div>
        <div class="in_body">
            
            <div class="a_groups">
                {% for group in all_groups %}
                {% if not group.is_active %}
                <form class="group_item" action="{% url 'submit_inputs' slug %}" method="post">
                    {% csrf_token %}
                    <a class="top" href="{% url 'group_detail' group.id slug %}"><button type="button" class="dept-info">
                        <h3 class="heading_pos">{{ group.name }}</h3>
                        <p class="count">
                            {% with staff_list=groups_list|get_item:group %}
                                {{ staff_list|length }} staff
                            {% endwith %}
                        </p>
                    </button></a>
                    <input type="hidden" name="form_meta" value="restore_group" id="">
                    <input type="hidden" value="{{group.id}}" name="group_ids">
                    <button type="submit" class="np">Restore</button>
                </form>
                {% endif %}
                {% empty %}
                    <div class="no-groups">No groups found.</div>
                {% endfor %}
            </div>
        </div>
        
    </div>
    <div class="pagination-bar" data-section="groups"></div>

    <form action="{% url 'submit_inputs' slug %}" method="post" id="group_form" class="group_form" style="display: none;">
        {% csrf_token %}
        <input type="hidden" value="del_group" name="form_meta" id="">
    </form>

    
</div>
{% endblock %}