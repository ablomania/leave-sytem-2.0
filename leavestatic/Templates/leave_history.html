{% extends 'main.html' %}
{% load static %}

{% block title %}
    History
{% endblock %}

{% block content %}
<div class="leave-history-container">
  {% for year, requests in grouped_leave.items %}
    <h2>{{ year }}</h2>
    <div class="leave-card-grid">
      {% for req in requests %}
        <div class="leave-card">
          <h3>
            {{ req.type.name }}
            <span class="status-tag status-{{ req.status|lower }}">{{ req.status }}</span>
          </h3>
          <p><strong>Applied:</strong> {{ req.application_date }}</p>
          <p><strong>Duration:</strong> {{ req.start_date }} to {{ req.return_date }}</p>

          <h4>Relieving Officer Acknowledgment</h4>
          {% for ack in req.ack_set.all %}
            <p>{{ ack.staff.first_name }}:
              <span class="status-tag status-{{ ack.status|lower }}">{{ ack.status }}</span>
            </p>
          {% empty %}
            <p class="empty">No acknowledgment yet.</p>
          {% endfor %}

          <h4>Approval Progress</h4>
          {% for approval in req.approval_set.all %}
            <p>{{ approval.approver.staff.first_name }}:
              <span class="status-tag status-{{ approval.status|lower }}">{{ approval.status }}</span>
            </p>
          {% empty %}
            <p class="empty">No approvals yet.</p>
          {% endfor %}
        </div>
      {% endfor %}
    </div>
  {% endfor %}
</div>

{% endblock %}